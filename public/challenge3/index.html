<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SQL Injection - Îç∞Ïù¥ÌÑ∞Î≤†Ïù¥Ïä§ Ï†ïÎ≥¥</title>
    <link rel="stylesheet" href="../style.css">
    <style>
        .challenge-container { max-width: 600px; margin: 0 auto; }
        .challenge-box { background: #fff; border-radius: 18px; box-shadow: 0 4px 24px 0 rgba(84,9,218,0.10); padding: 36px 32px 32px 32px; margin-top: 32px; }
        .challenge-title { font-size: 1.3rem; font-weight: 800; color: #5409DA; margin-bottom: 18px; text-align: center; }
        .form-label { color: #4E71FF; font-weight: 600; margin-bottom: 6px; }
        .form-input { width: 100%; padding: 14px; border: 2px solid #8DD8FF; border-radius: 8px; font-size: 1rem; margin-bottom: 16px; background: #f8faff; color: #5409DA; transition: border 0.2s, box-shadow 0.2s; }
        .form-input:focus { border-color: #5409DA; outline: none; box-shadow: 0 0 0 2px #8DD8FF; }
        .action-btn { background: #5409DA; color: #fff; border: none; border-radius: 8px; padding: 14px 0; font-size: 1.1rem; font-weight: 700; width: 100%; cursor: pointer; transition: background 0.2s, transform 0.2s; margin-top: 8px; }
        .action-btn:hover { background: #4E71FF; transform: translateY(-2px) scale(1.03); }
        .result-area { margin-top: 20px; background: #f3f7ff; border-radius: 8px; padding: 18px 16px; color: #5409DA; box-shadow: 0 2px 8px 0 #8DD8FF22; display: none; }
        .flag-container { background: #5409DA; color: #fff; border-radius: 12px; margin: 32px 0 0 0; padding: 24px 0; text-align: center; font-size: 1.3rem; font-weight: 700; letter-spacing: 1px; box-shadow: 0 4px 24px 0 #5409DA22; }
        .flag { font-size: 1.2rem; color: #fff; background: #4E71FF; border-radius: 8px; padding: 10px 18px; margin-top: 12px; display: inline-block; }
        .source-btn { margin: 32px auto 0 auto; display: block; background: #fff; color: #5409DA; border: 2px solid #5409DA; border-radius: 8px; font-weight: 700; font-size: 1rem; padding: 10px 28px; cursor: pointer; transition: background 0.2s, color 0.2s, border 0.2s; }
        .source-btn:hover { background: #5409DA; color: #fff; }
        .modal-bg { display: none; position: fixed; z-index: 9999; left: 0; top: 0; width: 100vw; height: 100vh; background: rgba(30, 20, 60, 0.75); justify-content: center; align-items: center; }
        .modal-bg.active { display: flex; }
        .modal { background: #181c2f; color: #fff; border-radius: 14px; max-width: 90vw; width: 540px; max-height: 80vh; overflow: auto; box-shadow: 0 8px 32px 0 #5409DA55; padding: 32px 24px 24px 24px; position: relative; }
        .modal-title { font-size: 1.2rem; font-weight: 700; margin-bottom: 18px; color: #8DD8FF; }
        .modal-close { position: absolute; top: 18px; right: 18px; background: none; border: none; color: #8DD8FF; font-size: 1.5rem; cursor: pointer; }
        pre.code-block { background: #23263a; color: #8DD8FF; border-radius: 8px; padding: 18px 12px; font-size: 0.98rem; font-family: 'Fira Mono', 'Consolas', 'Menlo', monospace; overflow-x: auto; margin: 0; }
        .hint { background: #f8faff; border-left: 4px solid #5409DA; padding: 16px; margin: 20px 0; border-radius: 0 8px 8px 0; }
        .hint h4 { color: #5409DA; margin: 0 0 8px 0; }
        .hint p { margin: 0; color: #666; }
    </style>
</head>
<body>
    <nav class="main-nav">
        <div class="nav-inner">
            <div class="nav-logo">üóÑÔ∏è SQL Injection CTF</div>
            <div class="nav-actions">
                <a href="../index.html" class="back-btn" style="color: #fff;">‚Üê Î©îÏù∏ÏúºÎ°ú</a>
            </div>
        </div>
    </nav>
    <div class="container">
        <header>
            <h1 style="color: #fff;">SQL Injection - Îç∞Ïù¥ÌÑ∞Î≤†Ïù¥Ïä§ Ï†ïÎ≥¥</h1>
            <p style="color: #fff;">Ï∑®ÏïΩÌïú ÏøºÎ¶¨ ÏûÖÎ†•ÏùÑ ÌÜµÌï¥ Ïä§ÌÇ§Îßà Ï†ïÎ≥¥Î•º Ï∂îÏ∂úÌï¥Î≥¥ÏÑ∏Ïöî.</p>
        </header>

        <div class="challenge-container">
            <div class="challenge-box">
                <div class="challenge-title">Ïä§ÌÇ§Îßà Ï†ïÎ≥¥ Ï°∞Ìöå</div>
                <form id="queryForm">
                    <label for="query" class="form-label">SQL ÏøºÎ¶¨</label>
                    <textarea id="query" class="form-input" style="height:100px;resize:vertical;" placeholder="SQL Injection ÌéòÏù¥Î°úÎìúÎ•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî..."></textarea>
                    <button type="submit" class="action-btn">ÏøºÎ¶¨ Ïã§Ìñâ</button>
                </form>
                <div id="queryResult" class="result-area">
                    <h3>Ïã§Ìñâ Í≤∞Í≥º</h3>
                    <div id="queryContent"></div>
                </div>
            </div>
        </div>

        <button class="source-btn" id="showSourceBtn">ÏÜåÏä§ÏΩîÎìú Î≥¥Í∏∞</button>
        
        <div class="modal-bg" id="modalBg">
            <div class="modal">
                <button class="modal-close" id="closeModalBtn">&times;</button>
                <div class="modal-title">Î¨∏Ï†ú ÏÜåÏä§ÏΩîÎìú (Node.js/Express)</div>
                <pre class="code-block">// Ï∑®ÏïΩÌïú ÏøºÎ¶¨ Ïã§Ìñâ
router.post('/api/challenge3/schema', async (req, res) => {
    const { query } = req.body;
    let conn;
    try {
        conn = await pool.getConnection();
        const [results] = await conn.query(query);
        
        // information_schema Ï†ëÍ∑º ÏãúÎèÑ Í∞êÏßÄ
        if (query.toLowerCase().includes('information_schema') && results.length > 0) {
            res.json({ 
                success: true, 
                results: results,
                flag: 'FLAG{SQLi_Schema_Extraction_2024}'
            });
        } else {
            res.json({ success: true, results });
        }
    } catch (err) {
        res.json({ success: false, message: 'SQL Ïò§Î•ò: ' + err.message });
    } finally {
        if (conn) conn.release();
    }
});</pre>
            </div>
        </div>

        <div id="flag-container" class="flag-container" style="display: none;">
            <h2>üéâ ÏÑ±Í≥µ!</h2>
            <div class="flag">
                <span id="flag-text"></span>
            </div>
        </div>
    </div>

    <script>
        document.getElementById('queryForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            const query = document.getElementById('query').value;
            const resultArea = document.getElementById('queryResult');
            const resultContent = document.getElementById('queryContent');
            
            try {
                const response = await fetch('/api/challenge3/schema', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ query })
                });
                const data = await response.json();
                
                resultArea.style.display = 'block';
                if (data.clearMessage) {
                    document.getElementById('flag-container').style.display = 'block';
                    document.getElementById('flag-text').textContent = data.clearMessage;
                    resultContent.innerHTML = `
                        <div style='color:#00bb77;font-weight:bold;margin-bottom:15px;'>üéâ ${data.clearMessage}</div>
                    `;
                }
                
                if (data.results) {
                    let html = '';
                    if (Array.isArray(data.results)) {
                        if (data.results.length > 0) {
                            html = data.results.map(row =>
                                `<div>${Object.entries(row).map(([k, v]) => `<b>${k}</b>: ${v}`).join(', ')}</div>`
                            ).join('');
                        }
                    } else if (typeof data.results === 'object') {
                        html = `<div>${Object.entries(data.results).map(([k, v]) => `<b>${k}</b>: ${v}`).join(', ')}</div>`;
                    } else {
                        html = `<div>${data.results}</div>`;
                    }
                    resultContent.innerHTML = html;
                } else {
                    resultContent.innerHTML = '';
                }
            } catch (error) {
                resultArea.style.display = 'block';
                resultContent.innerHTML = `<div style='color:#ff4444;font-weight:bold;'>‚ùå ÏøºÎ¶¨ Ïã§Ìñâ Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.</div>`;
            }
        });

        // ÏÜåÏä§ÏΩîÎìú Î™®Îã¨
        const showSourceBtn = document.getElementById('showSourceBtn');
        const modalBg = document.getElementById('modalBg');
        const closeModalBtn = document.getElementById('closeModalBtn');
        showSourceBtn.onclick = () => { modalBg.classList.add('active'); };
        closeModalBtn.onclick = () => { modalBg.classList.remove('active'); };
        modalBg.onclick = (e) => { if (e.target === modalBg) modalBg.classList.remove('active'); };
    </script>
</body>
</html> 